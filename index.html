<!DOCTYPE html>
<html lang="ko">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- iOS PWA ÏÑ§Ï†ï -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ÌÉÄÏù¥Î®∏">

  <!-- Android PWA ÏÑ§Ï†ï -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#282c34">

  <!-- PWA Display Î™®Îìú -->
  <meta name="display" content="fullscreen">

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- ÌååÎπÑÏΩò -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">

  <title>ÌÉÄÏù¥Î®∏ Ïï±</title>
  <style>
    /* ========== Í∏∞Î≥∏ Ïä§ÌÉÄÏùº Ï¥àÍ∏∞Ìôî ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      overflow: hidden;
      touch-action: manipulation;
      user-select: none;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    /* ========== Î©îÏù∏ ÌôîÎ©¥ ========== */
    #mainScreen {
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    #settingsBtn {
      position: absolute;
      top: min(5vw, 30px);
      right: min(5vw, 30px);
      width: clamp(50px, 12vw, 70px);
      height: clamp(50px, 12vw, 70px);
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.25);
      border-radius: 12px;
      cursor: pointer;
      z-index: 10;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: clamp(4px, 1vw, 6px);
      padding: clamp(12px, 3vw, 16px);
      box-sizing: border-box;
    }

    #settingsBtn .hamburger-line {
      width: 100%;
      height: clamp(3px, 0.7vw, 4px);
      background: white;
      border-radius: 2px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    #settingsBtn:hover {
      background: rgba(255,255,255,0.25);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    #settingsBtn:hover .hamburger-line {
      background: rgba(255,255,255,0.95);
    }

    #settingsBtn:active {
      transform: scale(0.92);
    }

    .clock-container {
      text-align: center;
      padding: 20px;
      animation: fadeInUp 0.8s ease-out;
      width: 90vw;
      max-width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #dateDisplay {
      position: absolute;
      top: min(5vw, 30px);
      left: min(5vw, 30px);
      width: auto;
      height: auto;
      min-height: clamp(50px, 12vw, 70px);
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 50px;
      padding: clamp(10px, 2vw, 15px) clamp(20px, 4vw, 30px);
      font-size: clamp(30px, 6vw, 50px);
      font-weight: 600;
      color: white;
      z-index: 10;
      white-space: nowrap;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      line-height: 1;
      box-sizing: border-box;
    }

    #dateDisplay:hover {
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    #timeDisplay {
      font-size: 1em;
      font-weight: 700;
      line-height: 1;
      letter-spacing: -0.02em;
      text-shadow: 0 4px 20px rgba(0,0,0,0.15);
      white-space: nowrap;
      display: flex;
      align-items: baseline;
      justify-content: center;
      gap: 0.15em;
      font-variant-numeric: tabular-nums;
    }

    #timeDisplay span {
      font-variant-numeric: tabular-nums;
    }

    .time-ampm, .time-seconds {
      font-size: 25%;
      opacity: 0.85;
      font-weight: 400;
    }

    /* ========== ÌÉÄÏù¥Î®∏ Ïπ¥Îìú Ïò§Î≤ÑÎ†àÏù¥ ========== */
    #timerCardsOverlay {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      z-index: 100;
      pointer-events: none;
      background: transparent;
    }

    #timerCardsOverlay.show {
      display: block;
      pointer-events: auto;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .cards-container {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      max-height: 75vh;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(20px);
      border-radius: 30px 30px 0 0;
      padding: min(6vw, 30px);
      padding-top: 20px;
      overflow-y: auto;
      transform: translateY(100%);
      transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      pointer-events: auto;
      box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
    }

    #timerCardsOverlay.show .cards-container {
      transform: translateY(0);
    }

    .cards-container::before {
      content: '';
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 4px;
      background: rgba(0,0,0,0.2);
      border-radius: 2px;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(min(140px, 28vw), 1fr));
      gap: min(4vw, 20px);
      margin-top: 20px;
    }

    @media (min-width: 768px) {
      .cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 20px;
      }
    }

    .timer-card {
      aspect-ratio: 1 / 1;
      border: none;
      border-radius: 20px;
      padding: min(3vw, 15px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: linear-gradient(135deg, rgba(102,126,234,0.1) 0%, rgba(118,75,162,0.1) 100%);
      backdrop-filter: blur(10px);
      gap: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      border: 1px solid rgba(102,126,234,0.2);
      width: 100%;
      height: auto;
    }

    .timer-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      background: linear-gradient(135deg, rgba(102,126,234,0.15) 0%, rgba(118,75,162,0.15) 100%);
    }

    .timer-card:active {
      transform: translateY(-2px) scale(0.98);
    }

    .timer-card.add-card {
      border: 2px dashed rgba(102,126,234,0.4);
      font-size: clamp(40px, 12vw, 80px);
      color: rgba(102,126,234,0.6);
      background: rgba(102,126,234,0.05);
      font-weight: 300;
    }

    .timer-card.add-card:hover {
      border-color: rgba(102,126,234,0.6);
      color: rgba(102,126,234,0.8);
      background: rgba(102,126,234,0.1);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      width: 100%;
      margin-bottom: 8px;
      gap: 6px;
    }

    .card-name {
      font-weight: 700;
      font-size: clamp(13px, 3.2vw, 18px);
      color: #2d3748;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
      flex: 1;
      line-height: 1.3;
      padding-top: 2px;
    }

    .card-menu-btn {
      background: rgba(102,126,234,0.1);
      border: none;
      font-size: clamp(18px, 4.5vw, 24px);
      cursor: pointer;
      padding: 4px;
      min-width: clamp(28px, 7vw, 36px);
      width: clamp(28px, 7vw, 36px);
      height: clamp(28px, 7vw, 36px);
      color: #667eea;
      border-radius: 8px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .card-menu-btn:hover {
      background: rgba(102,126,234,0.2);
      transform: scale(1.08);
    }

    .card-menu-btn:active {
      transform: scale(0.92);
    }

    .card-info {
      font-size: clamp(11px, 2.8vw, 16px);
      color: #4a5568;
      line-height: 1.6;
      font-weight: 500;
    }

    /* ========== Î™®Îã¨ ========== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(8px);
      z-index: 200;
      justify-content: center;
      align-items: center;
      padding: 20px;
      animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 24px;
      padding: min(6vw, 30px);
      width: 100%;
      max-width: 500px;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(102,126,234,0.1);
    }

    .modal-title {
      font-size: clamp(20px, 5vw, 26px);
      font-weight: 700;
      color: #2d3748;
      letter-spacing: -0.5px;
    }

    .close-btn {
      background: rgba(102,126,234,0.1);
      border: none;
      font-size: clamp(24px, 6vw, 32px);
      cursor: pointer;
      padding: 0;
      width: clamp(40px, 10vw, 48px);
      height: clamp(40px, 10vw, 48px);
      border-radius: 12px;
      color: #667eea;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-btn:hover {
      background: rgba(102,126,234,0.2);
      transform: scale(1.05);
    }

    .close-btn:active {
      transform: scale(0.95);
    }

    .setting-section {
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .setting-section.inline {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .setting-section.inline .setting-label {
      margin-bottom: 0;
      flex-shrink: 0;
    }

    .setting-section.inline input[type="number"] {
      margin-bottom: 0;
      max-width: 150px;
    }

    @media (max-width: 767px) {
      .setting-section.inline input[type="number"] {
        max-width: 120px;
      }
    }

    .setting-label {
      font-weight: 700;
      margin-bottom: 15px;
      display: block;
      font-size: clamp(16px, 4vw, 20px);
      color: #2d3748;
      letter-spacing: -0.3px;
    }

    /* ========== ÏãúÍ∞Ñ ÏÑ†ÌÉùÍ∏∞ ========== */
    .time-picker {
      display: flex;
      gap: clamp(6px, 2vw, 10px);
      align-items: center;
      margin-bottom: 15px;
      justify-content: center;
    }

    .time-digit {
      width: clamp(50px, 12vw, 65px);
      height: clamp(60px, 14vw, 75px);
      font-size: clamp(28px, 7vw, 36px);
      font-weight: 700;
      text-align: center;
      border: 2px solid rgba(102,126,234,0.3);
      border-radius: 12px;
      background: rgba(102,126,234,0.05);
      color: #2d3748;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      padding: 0;
      transition: all 0.2s;
    }

    .time-digit:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
      transform: scale(1.05);
    }

    .time-digit:hover {
      border-color: #667eea;
      background: rgba(102,126,234,0.08);
    }

    .time-separator {
      font-size: clamp(28px, 7vw, 36px);
      font-weight: 700;
      margin: 0 clamp(3px, 1vw, 8px);
      color: #667eea;
    }

    /* ========== ÏÜåÎ¶¨ ÏÑ†ÌÉù ========== */
    .sound-select-group {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .sound-select-item {
      flex: 1;
    }

    .sound-select-item label {
      font-size: 12px;
      display: block;
      margin-bottom: 5px;
    }

    @media (orientation: portrait) {
      .sound-select-item label {
        font-size: 16px;
      }
    }

    .sound-select-item select {
      width: 100%;
      padding: 12px;
      font-size: 14px;
      border: 2px solid #007AFF;
      border-radius: 8px;
      background: white;
      cursor: pointer;
    }

    @media (orientation: portrait) {
      .sound-select-item select {
        padding: 16px;
        font-size: 18px;
      }
    }

    .color-picker-group {
      display: flex;
      gap: 12px;
      margin-bottom: 15px;
    }

    .color-picker-item {
      flex: 1;
      position: relative;
    }

    .color-picker-item label {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 14px;
      font-weight: bold;
      color: white;
      text-shadow:
        0 1px 2px rgba(0,0,0,0.8),
        0 2px 4px rgba(0,0,0,0.6),
        0 0 8px rgba(0,0,0,0.4);
      z-index: 1;
      pointer-events: none;
      letter-spacing: 0.5px;
    }

    @media (orientation: portrait) {
      .color-picker-item label {
        font-size: 18px;
      }
    }

    .color-picker-item input[type="color"] {
      width: 100%;
      height: 60px;
      border: 3px solid #dee2e6;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .color-picker-item input[type="color"]:hover {
      border-color: #667eea;
      box-shadow: 0 4px 8px rgba(102,126,234,0.2);
      transform: translateY(-1px);
    }

    .color-picker-item input[type="color"]:active {
      transform: translateY(0);
    }

    @media (orientation: portrait) {
      .color-picker-item input[type="color"] {
        height: 70px;
      }
    }

    .color-presets {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .color-preset-btn {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      border: 3px solid #fff;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      transition: all 0.2s ease;
      outline: 2px solid transparent;
      outline-offset: 2px;
    }

    .color-preset-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    }

    .color-preset-btn:active {
      transform: scale(0.95);
    }

    .color-preset-label {
      font-size: 13px;
      color: #6c757d;
      margin-bottom: 8px;
      font-weight: 600;
    }

    input[type="text"], input[type="number"] {
      width: 100%;
      padding: clamp(12px, 3vw, 16px);
      font-size: clamp(15px, 4vw, 18px);
      border: 2px solid rgba(102,126,234,0.2);
      border-radius: 12px;
      margin-bottom: 10px;
      background: rgba(102,126,234,0.03);
      color: #2d3748;
      font-weight: 500;
      transition: all 0.2s;
    }

    input[type="text"]:focus, input[type="number"]:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    input[type="text"]:hover, input[type="number"]:hover {
      border-color: #667eea;
    }

    .slider-container {
      margin: 10px 0;
      padding: 20px 0;
    }

    input[type="range"] {
      width: 100%;
      height: 60px;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      padding: 0;
      margin: 15px 0;
    }

    input[type="range"]::-webkit-slider-track {
      width: 100%;
      height: 12px;
      background: linear-gradient(to right, #cbd5e1, #94a3b8);
      border-radius: 6px;
      border: 2px solid #64748b;
      box-shadow:
        inset 0 2px 4px rgba(0,0,0,0.2),
        0 1px 2px rgba(0,0,0,0.1);
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      cursor: pointer;
      margin-top: -10px;
      box-shadow:
        0 0 0 3px white,
        0 3px 8px rgba(102,126,234,0.5),
        0 1px 4px rgba(0,0,0,0.3);
      border: none;
      transition: all 0.2s ease;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.15);
      box-shadow:
        0 0 0 3px white,
        0 4px 12px rgba(102,126,234,0.6),
        0 2px 6px rgba(0,0,0,0.3);
    }

    input[type="range"]::-webkit-slider-thumb:active {
      transform: scale(1.05);
    }

    input[type="range"]::-moz-range-track {
      width: 100%;
      height: 12px;
      background: linear-gradient(to right, #cbd5e1, #94a3b8);
      border-radius: 6px;
      border: 2px solid #64748b;
      box-shadow:
        inset 0 2px 4px rgba(0,0,0,0.2),
        0 1px 2px rgba(0,0,0,0.1);
    }

    input[type="range"]::-moz-range-thumb {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      cursor: pointer;
      border: 3px solid white;
      box-shadow:
        0 3px 8px rgba(102,126,234,0.5),
        0 1px 4px rgba(0,0,0,0.3);
      transition: all 0.2s ease;
    }

    input[type="range"]::-moz-range-thumb:hover {
      transform: scale(1.15);
      box-shadow:
        0 4px 12px rgba(102,126,234,0.6),
        0 2px 6px rgba(0,0,0,0.3);
    }

    input[type="range"]::-moz-range-thumb:active {
      transform: scale(1.05);
    }

    /* Edge/IE ÏßÄÏõê */
    input[type="range"]::-ms-track {
      width: 100%;
      height: 16px;
      background: transparent;
      border-color: transparent;
      color: transparent;
    }

    input[type="range"]::-ms-fill-lower {
      background: #cbd5e1;
      border-radius: 8px;
      border: 3px solid #64748b;
    }

    input[type="range"]::-ms-fill-upper {
      background: #e2e8f0;
      border-radius: 8px;
      border: 3px solid #64748b;
    }

    input[type="range"]::-ms-thumb {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      cursor: pointer;
      border: 4px solid white;
      box-shadow: 0 4px 12px rgba(102,126,234,0.5);
    }

    @media (orientation: portrait) {
      input[type="range"] {
        height: 60px;
        margin: 20px 0;
      }

      input[type="range"]::-webkit-slider-track {
        height: 16px;
        border-radius: 8px;
        border: 3px solid #64748b;
      }

      input[type="range"]::-webkit-slider-thumb {
        width: 40px;
        height: 40px;
        margin-top: -14px;
        box-shadow:
          0 0 0 4px white,
          0 4px 12px rgba(102,126,234,0.6),
          0 2px 6px rgba(0,0,0,0.2);
      }

      input[type="range"]::-moz-range-track {
        height: 16px;
        border-radius: 8px;
        border: 3px solid #64748b;
      }

      input[type="range"]::-moz-range-thumb {
        width: 40px;
        height: 40px;
        border: 4px solid white;
        box-shadow:
          0 4px 12px rgba(102,126,234,0.6),
          0 2px 6px rgba(0,0,0,0.2);
      }

      input[type="range"]::-ms-thumb {
        width: 56px;
        height: 56px;
        border: 5px solid white;
      }
    }

    .checkbox-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
      font-size: 14px;
    }

    @media (orientation: portrait) {
      .checkbox-container {
        font-size: 18px;
      }
    }

    .checkbox-container input[type="checkbox"] {
      width: 24px;
      height: 24px;
      cursor: pointer;
    }

    @media (orientation: portrait) {
      .checkbox-container input[type="checkbox"] {
        width: 32px;
        height: 32px;
      }
    }

    .file-upload-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px solid #eee;
    }

    .file-upload-btn {
      width: 100%;
      padding: 15px;
      font-size: 16px;
      border: 2px dashed #007AFF;
      border-radius: 10px;
      background: #f0f8ff;
      color: #007AFF;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 10px;
      display: block;
      text-align: center;
    }

    input[type="file"] {
      display: none;
    }

    .btn-group {
      display: flex;
      gap: clamp(10px, 2.5vw, 15px);
      margin-top: 25px;
    }

    .btn {
      flex: 1;
      padding: clamp(14px, 3.5vw, 18px);
      font-size: clamp(15px, 4vw, 18px);
      font-weight: 700;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      letter-spacing: -0.3px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #5568d3 0%, #63408a 100%);
    }

    .btn-danger {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
    }

    .btn-danger:hover {
      background: linear-gradient(135deg, #e082ea 0%, #e4465b 100%);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #a8a8a8 0%, #8e8e8e 100%);
      color: white;
    }

    .btn-secondary:hover {
      background: linear-gradient(135deg, #979797 0%, #7d7d7d 100%);
    }

    /* ========== ÌÉÄÏù¥Î®∏ Ïã§Ìñâ ÌôîÎ©¥ ========== */
    #timerScreen {
      display: none;
      width: 100vw;
      height: 100vh;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      padding: 20px 0;
      box-sizing: border-box;
    }

    #timerScreen.show {
      display: flex;
      animation: fadeIn 0.3s ease-out;
    }

    #timerScreen.paused {
      filter: blur(8px) brightness(0.6);
    }


    .pause-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 250;
      pointer-events: auto;
      cursor: pointer;
    }

    .pause-overlay.show {
      display: flex;
    }

    .pause-text {
      font-size: 80px;
      font-weight: bold;
      color: white;
      text-shadow: 0 0 20px rgba(0,0,0,0.8);
      margin-bottom: 20px;
    }

    .current-time-small {
      text-align: center;
      font-size: clamp(32px, 7vw, 60px);
      padding: 0;
      background: transparent;
      border: none;
      font-weight: 800;
      color: white !important;
      z-index: 5;
      flex-shrink: 0;
      letter-spacing: -1px;
      margin: 0;
      width: auto;
      display: inline-block;
      align-self: flex-start;
      font-variant-numeric: tabular-nums;
      position: absolute;
      top: 10px;
      left: 10px;
    }

    /* Í∞ÄÎ°ú ÌôîÎ©¥ ÎåÄÏùë */
    @media (orientation: landscape) {
      .current-time-small {
        font-size: clamp(20px, 4vh, 40px);
        top: 10px;
        left: 10px;
      }
    }

    @media (orientation: landscape) and (max-height: 500px) {

      #settingsBtn {
        width: clamp(25px, 6vw, 35px);
        height: clamp(25px, 6vw, 35px);
        top: clamp(10px, 2vh, 15px);
        right: clamp(10px, 2vh, 15px);
        gap: clamp(2px, 0.5vw, 3px);
        padding: clamp(6px, 1.5vw, 8px);
      }

      #settingsBtn .hamburger-line {
        height: clamp(2px, 0.4vw, 2.5px);
      }


      .timer-display {
        gap: clamp(5px, 1vh, 10px);
        padding: 5px;
      }

      .timer-main-row {
        gap: clamp(10px, 3vw, 25px);
      }

      .timer-phase, .timer-round {
        font-size: clamp(20px, 4vh, 40px);
      }

      #timerTime {
        font-size: clamp(60px, 28vw, 250px);
      }

      .timer-name {
        font-size: clamp(18px, 3.5vh, 35px);
        position: absolute;
        top: 10px;
        right: 10px;
        margin: 0;
      }
    }

    .timer-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: clamp(10px, 2vw, 15px);
      padding: 5px;
      animation: fadeInUp 0.5s ease-out;
      flex: 1;
      width: 100%;
      max-width: 100vw;
      position: relative;
    }

    .timer-main-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: clamp(15px, 4vw, 35px);
      flex-wrap: nowrap;
      width: 100%;
    }

    .timer-phase {
      font-size: clamp(32px, 7vw, 60px);
      font-weight: 800;
      text-shadow: 0 4px 20px rgba(0,0,0,0.2);
      letter-spacing: -1px;
      flex-shrink: 0;
      white-space: nowrap;
    }

    .timer-round {
      font-size: clamp(32px, 7vw, 60px);
      font-weight: 800;
      text-shadow: 0 4px 20px rgba(0,0,0,0.2);
      letter-spacing: -1px;
      flex-shrink: 0;
      white-space: nowrap;
      min-width: fit-content;
    }

    #timerTime {
      font-size: clamp(80px, 20vw, 220px);
      font-weight: 800;
      line-height: 1;
      text-shadow: 0 6px 30px rgba(0,0,0,0.25);
      letter-spacing: -3px;
      white-space: nowrap;
      overflow: visible;
      font-variant-numeric: tabular-nums;
      flex-shrink: 0;
    }

    #timerTime span {
      font-variant-numeric: tabular-nums;
    }

    .timer-name {
      font-size: clamp(28px, 6vw, 55px);
      font-weight: 700;
      opacity: 0.9;
      text-shadow: 0 2px 15px rgba(0,0,0,0.15);
      letter-spacing: -0.5px;
      position: absolute;
      top: 10px;
      right: 10px;
      margin: 0;
      z-index: 10;
    }

    /* ÏÑ∏Î°ú ÌôîÎ©¥ ÎåÄÏùë */
    @media (orientation: portrait) {
      .timer-main-row {
        flex-direction: column;
        gap: clamp(20px, 4vh, 40px);
        flex-wrap: nowrap;
      }

      #timerTime {
        font-size: clamp(100px, 25vw, 280px);
      }

      .timer-phase, .timer-round {
        font-size: clamp(40px, 10vw, 80px);
      }

      .timer-name {
        font-size: clamp(32px, 8vw, 70px);
      }
    }

    .stop-guide {
      position: relative;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(10px);
      color: white;
      padding: clamp(12px, 3vw, 18px) clamp(20px, 5vw, 30px);
      border-radius: 20px;
      font-size: clamp(18px, 4.5vw, 32px);
      display: none;
      z-index: 300;
      box-shadow: 0 8px 30px rgba(0,0,0,0.3);
      font-weight: 600;
      letter-spacing: -0.3px;
    }

    .stop-guide.show {
      display: block;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.85; transform: scale(1.02); }
    }

    .progress-circle {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 120px;
      height: 120px;
      display: none;
      z-index: 300;
    }

    .progress-circle.show {
      display: block;
      animation: rotate 1s linear;
    }

    .progress-circle circle {
      fill: none;
      stroke: #ffffff;
      stroke-width: 10;
      stroke-dasharray: 339;
      stroke-dashoffset: 339;
      transform-origin: center;
      filter: drop-shadow(0 0 10px rgba(255,255,255,0.8));
    }

    .progress-circle.filling circle {
      animation: fillProgress 1s linear forwards;
    }

    @keyframes fillProgress {
      to {
        stroke-dashoffset: 0;
      }
    }

    @keyframes rotate {
      from {
        transform: translate(-50%, -50%) rotate(0deg);
      }
      to {
        transform: translate(-50%, -50%) rotate(360deg);
      }
    }

    .toast {
      position: fixed;
      bottom: clamp(30px, 8vw, 50px);
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(10px);
      color: white;
      padding: clamp(12px, 3vw, 16px) clamp(20px, 5vw, 30px);
      border-radius: 20px;
      font-size: clamp(14px, 3.5vw, 16px);
      display: none;
      z-index: 400;
      animation: toastSlideIn 3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 30px rgba(0,0,0,0.4);
      font-weight: 600;
      letter-spacing: -0.2px;
      max-width: 90vw;
      text-align: center;
    }

    @keyframes toastSlideIn {
      0% {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
      }
      10%, 90% {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
      100% {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
      }
    }

    .toast.show {
      display: block;
    }
  </style>
</head>
<body>
  <div id="mainScreen">
    <div id="dateDisplay"></div>
    <button id="settingsBtn">
      <div class="hamburger-line"></div>
      <div class="hamburger-line"></div>
      <div class="hamburger-line"></div>
    </button>
    <div class="clock-container">
      <div id="timeDisplay">
        <span class="time-ampm" id="ampm"></span>
        <span id="hours"></span>:<span id="minutes"></span>
        <span class="time-seconds" id="seconds"></span>
      </div>
    </div>
  </div>

  <div id="timerCardsOverlay">
    <div class="cards-container">
      <div class="cards-grid" id="cardsGrid"></div>
    </div>
  </div>

  <div id="timerScreen">
    <div class="current-time-small" id="currentTimeSmall"></div>
    <div class="timer-display">
      <div class="timer-main-row">
        <span class="timer-phase" id="timerPhase">Ï§ÄÎπÑ</span>
        <div id="timerTime">
          <span id="timerMinutes">00</span>:<span id="timerSeconds">00</span>
        </div>
        <span class="timer-round" id="timerRound">1/3</span>
      </div>
      <div class="timer-name" id="timerName">ÌÉÄÏù¥Î®∏ 1</div>
    </div>
  </div>

  <div class="pause-overlay" id="pauseOverlay">
    <div class="pause-text">ÏùºÏãúÏ†ïÏßÄ</div>
    <div class="stop-guide" id="stopGuide">Í∏∏Í≤å ÎàÑÎ•¥Î©¥ Ï¢ÖÎ£å</div>
  </div>

  <svg class="progress-circle" id="progressCircle" viewBox="0 0 120 120">
    <circle cx="60" cy="60" r="54"></circle>
  </svg>

  <div class="toast" id="toast"></div>

  <div class="modal" id="timerSettingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">ÌÉÄÏù¥Î®∏ ÏÑ§Ï†ï</div>
        <button class="close-btn" onclick="closeTimerSettings()">√ó</button>
      </div>
      
      <div class="setting-section">
        <label class="setting-label">ÌÉÄÏù¥Î®∏ Ïù¥Î¶Ñ</label>
        <input type="text" id="timerNameInput" placeholder="ÌÉÄÏù¥Î®∏ Ïù¥Î¶Ñ">
      </div>

      <div class="setting-section">
        <label class="setting-label">Ï§ÄÎπÑ ÏãúÍ∞Ñ</label>
        <div class="time-picker">
          <select class="time-digit" id="prepareMin1">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
          <select class="time-digit" id="prepareMin2">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
          <span class="time-separator">:</span>
          <select class="time-digit" id="prepareSec1">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
          <select class="time-digit" id="prepareSec2">
            <option value="0" selected>0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
        </div>
        <div class="color-picker-group">
          <div class="color-picker-item">
            <label>Î∞∞Í≤ΩÏÉâ</label>
            <input type="color" id="prepareBg" value="#FFA500">
          </div>
          <div class="color-picker-item">
            <label>Í∏ÄÏûêÏÉâ</label>
            <input type="color" id="prepareColor" value="#FFFFFF">
          </div>
        </div>
        <div class="sound-select-group">
          <div class="sound-select-item">
            <label>ÏãúÏûëÏùå</label>
            <select id="prepareStartSound">
              <option value="none" selected>Î¨¥Ïùå</option>
              <option value="default">Í∏∞Î≥∏Ïùå</option>
              <option value="beep">ÏÇê</option>
              <option value="bell">Î≤®</option>
              <option value="alarm">ÏïåÎûå</option>
              <option value="boxing">Î≥µÏã±Î≤®</option>
              <option value="start">ÏãúÏûë</option>
              <option value="wow">ÏôÄÏö∞</option>
              <option value="ac">ÏóêÏñ¥Ïª®</option>
            </select>
          </div>
          <div class="sound-select-item">
            <label>Ï¢ÖÎ£åÏùå</label>
            <select id="prepareEndSound">
              <option value="none">Î¨¥Ïùå</option>
              <option value="default" selected>Í∏∞Î≥∏Ïùå</option>
              <option value="beep">ÏÇê</option>
              <option value="bell">Î≤®</option>
              <option value="alarm">ÏïåÎûå</option>
              <option value="boxing">Î≥µÏã±Î≤®</option>
              <option value="start">ÏãúÏûë</option>
              <option value="wow">ÏôÄÏö∞</option>
              <option value="ac">ÏóêÏñ¥Ïª®</option>
            </select>
          </div>
        </div>
      </div>

      <div class="setting-section">
        <label class="setting-label">Ïö¥Îèô ÏãúÍ∞Ñ</label>
        <div class="time-picker">
          <select class="time-digit" id="workMin1">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
          <select class="time-digit" id="workMin2">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
          <span class="time-separator">:</span>
          <select class="time-digit" id="workSec1">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3" selected>3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
          <select class="time-digit" id="workSec2">
            <option value="0" selected>0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
        </div>
        <div class="color-picker-group">
          <div class="color-picker-item">
            <label>Î∞∞Í≤ΩÏÉâ</label>
            <input type="color" id="workBg" value="#2196F3">
          </div>
          <div class="color-picker-item">
            <label>Í∏ÄÏûêÏÉâ</label>
            <input type="color" id="workColor" value="#FFFFFF">
          </div>
        </div>
        <div class="sound-select-group">
          <div class="sound-select-item">
            <label>ÏãúÏûëÏùå</label>
            <select id="workStartSound">
              <option value="none" selected>Î¨¥Ïùå</option>
              <option value="default">Í∏∞Î≥∏Ïùå</option>
              <option value="beep">ÏÇê</option>
              <option value="bell">Î≤®</option>
              <option value="alarm">ÏïåÎûå</option>
              <option value="boxing">Î≥µÏã±Î≤®</option>
              <option value="start">ÏãúÏûë</option>
              <option value="wow">ÏôÄÏö∞</option>
              <option value="ac">ÏóêÏñ¥Ïª®</option>
            </select>
          </div>
          <div class="sound-select-item">
            <label>Ï¢ÖÎ£åÏùå</label>
            <select id="workEndSound">
              <option value="none">Î¨¥Ïùå</option>
              <option value="default" selected>Í∏∞Î≥∏Ïùå</option>
              <option value="beep">ÏÇê</option>
              <option value="bell">Î≤®</option>
              <option value="alarm">ÏïåÎûå</option>
              <option value="boxing">Î≥µÏã±Î≤®</option>
              <option value="start">ÏãúÏûë</option>
              <option value="wow">ÏôÄÏö∞</option>
              <option value="ac">ÏóêÏñ¥Ïª®</option>
            </select>
          </div>
        </div>
      </div>

      <div class="setting-section">
        <label class="setting-label">Ìú¥Ïãù ÏãúÍ∞Ñ</label>
        <div class="time-picker">
          <select class="time-digit" id="restMin1">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
          <select class="time-digit" id="restMin2">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
          <span class="time-separator">:</span>
          <select class="time-digit" id="restSec1">
            <option value="0">0</option>
            <option value="1" selected>1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
          <select class="time-digit" id="restSec2">
            <option value="0" selected>0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
        </div>
        <div class="color-picker-group">
          <div class="color-picker-item">
            <label>Î∞∞Í≤ΩÏÉâ</label>
            <input type="color" id="restBg" value="#FF0000">
          </div>
          <div class="color-picker-item">
            <label>Í∏ÄÏûêÏÉâ</label>
            <input type="color" id="restColor" value="#FFFFFF">
          </div>
        </div>
        <div class="sound-select-group">
          <div class="sound-select-item">
            <label>ÏãúÏûëÏùå</label>
            <select id="restStartSound">
              <option value="none" selected>Î¨¥Ïùå</option>
              <option value="default">Í∏∞Î≥∏Ïùå</option>
              <option value="beep">ÏÇê</option>
              <option value="bell">Î≤®</option>
              <option value="alarm">ÏïåÎûå</option>
              <option value="boxing">Î≥µÏã±Î≤®</option>
              <option value="start">ÏãúÏûë</option>
              <option value="wow">ÏôÄÏö∞</option>
              <option value="ac">ÏóêÏñ¥Ïª®</option>
            </select>
          </div>
          <div class="sound-select-item">
            <label>Ï¢ÖÎ£åÏùå</label>
            <select id="restEndSound">
              <option value="none">Î¨¥Ïùå</option>
              <option value="default" selected>Í∏∞Î≥∏Ïùå</option>
              <option value="beep">ÏÇê</option>
              <option value="bell">Î≤®</option>
              <option value="alarm">ÏïåÎûå</option>
              <option value="boxing">Î≥µÏã±Î≤®</option>
              <option value="start">ÏãúÏûë</option>
              <option value="wow">ÏôÄÏö∞</option>
              <option value="ac">ÏóêÏñ¥Ïª®</option>
            </select>
          </div>
        </div>
      </div>

      <div class="setting-section inline">
        <label class="setting-label">ÎùºÏö¥Îìú</label>
        <input type="number" id="rounds" min="1" max="99" value="3">
      </div>

      <div class="file-upload-section">
        <label class="setting-label">Ïª§Ïä§ÌÖÄ ÏùåÏõê Ï∂îÍ∞Ä</label>
        <input type="file" id="customSoundFile" accept="audio/*" multiple>
        <label for="customSoundFile" class="file-upload-btn">üìÅ ÏùåÏõê ÌååÏùº ÏóÖÎ°úÎìú</label>
      </div>

      <div class="btn-group">
        <button class="btn btn-danger" onclick="deleteTimer()">ÏÇ≠Ï†ú</button>
        <button class="btn btn-secondary" onclick="copyTimer()">Î≥µÏÇ¨</button>
        <button class="btn btn-primary" onclick="saveTimer()">ÌôïÏù∏</button>
      </div>
    </div>
  </div>

  <div class="modal" id="globalSettingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">ÌòÑÏû¨ÏãúÍ∞Ñ ÏÑ§Ï†ï</div>
        <button class="close-btn" onclick="closeGlobalSettings()">√ó</button>
      </div>

      <div class="setting-section">
        <label class="setting-label">Î∞∞Í≤Ω Í∑∏ÎùºÎç∞Ïù¥ÏÖò</label>
        <div class="color-picker-group">
          <div class="color-picker-item">
            <label>ÏãúÏûëÏÉâ</label>
            <input type="color" id="bgGradientStart" value="#667eea">
          </div>
          <div class="color-picker-item">
            <label>ÎÅùÏÉâ</label>
            <input type="color" id="bgGradientEnd" value="#764ba2">
          </div>
        </div>
      </div>

      <div class="setting-section">
        <label class="setting-label">Í∏ÄÏûêÏÉâ</label>
        <div class="color-picker-group">
          <div class="color-picker-item">
            <label>Í∏ÄÏûêÏÉâ</label>
            <input type="color" id="fontColor" value="#ffffff">
          </div>
        </div>
      </div>

      <div class="setting-section">
        <label class="setting-label">ÌôîÎ©¥ Í∫ºÏßê Î∞©ÏßÄ</label>
        <div class="checkbox-container">
          <input type="checkbox" id="keepScreenOn" checked>
          <label for="keepScreenOn">ÌÉÄÏù¥Î®∏ Ïã§Ìñâ Ï§ë ÌôîÎ©¥ Ïú†ÏßÄ</label>
        </div>
      </div>

      <div class="setting-section">
        <label class="setting-label">ÏÜåÎ¶¨</label>
        <div class="checkbox-container">
          <input type="checkbox" id="soundEnabled" checked>
          <label for="soundEnabled">ÏÜåÎ¶¨ Ïû¨ÏÉù</label>
        </div>
      </div>

      <div class="setting-section">
        <label class="setting-label">ÏßÑÎèô</label>
        <div class="checkbox-container">
          <input type="checkbox" id="vibrationEnabled" checked>
          <label for="vibrationEnabled">ÏßÑÎèô ÌîºÎìúÎ∞±</label>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn btn-primary" onclick="saveGlobalSettings()">ÌôïÏù∏</button>
      </div>
    </div>
  </div>

  <div class="modal" id="timerScreenSettingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">ÌÉÄÏù¥Î®∏ ÌôîÎ©¥ ÏÑ§Ï†ï</div>
        <button class="close-btn" onclick="closeTimerScreenSettings()">√ó</button>
      </div>

      <div class="setting-section" style="text-align: center; padding: 40px 20px;">
        <p style="font-size: 16px; color: #64748b; margin: 0;">ÌÉÄÏù¥Î®∏ ÌÅ¨Í∏∞Îäî ÌôîÎ©¥Ïóê ÎßûÏ∂∞ ÏûêÎèôÏúºÎ°ú Ï°∞Ï†ïÎê©ÎãàÎã§.</p>
      </div>

      <div class="btn-group">
        <button class="btn btn-primary" onclick="closeTimerScreenSettings()">ÌôïÏù∏</button>
      </div>
    </div>
  </div>

  <script>
    let timers = [];
    let currentTimerId = null;
    let runningTimer = null;
    let timerInterval = null;
    let isPaused = false;
    let longPressTimer = null;
    let audioContext = null;
    let wakeLock = null;
    let customSounds = {};
    let currentAudio = null; // ÌòÑÏû¨ Ïû¨ÏÉù Ï§ëÏù∏ Ïò§ÎîîÏò§ Ï∂îÏ†Å

    let globalSettings = {
      bgGradientStart: '#667eea',
      bgGradientEnd: '#764ba2',
      fontColor: '#ffffff',
      keepScreenOn: true,
      soundEnabled: true,
      vibrationEnabled: true
    };

    let timerScreenSettings = {
      numberSize: 50,
      textSize: 50
    };


    window.addEventListener('load', () => {
      loadSettings();
      loadTimerScreenSettings();
      loadTimers();
      renderCards();
      updateClock();
      setInterval(updateClock, 1000);
      setupEventListeners();
      setTimeout(() => {
        applyGlobalSettings();
        adjustClockSize();
      }, 100);
      // AudioContextÎäî ÏÇ¨Ïö©Ïûê Ïù∏ÌÑ∞ÎûôÏÖò ÌõÑÏóê Ï¥àÍ∏∞Ìôî

      // ÌôîÎ©¥ ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Ïãú ÏãúÍ≥Ñ ÌÅ¨Í∏∞ Ïû¨Ï°∞Ï†ï
      window.addEventListener('resize', () => {
        adjustClockSize();
        // ÌÉÄÏù¥Î®∏ ÌôîÎ©¥Ïù¥ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏúºÎ©¥ ÌÉÄÏù¥Î®∏ ÌÅ¨Í∏∞ÎèÑ Ï°∞Ï†ï
        if (document.getElementById('timerScreen').classList.contains('show')) {
          adjustTimerSize();
        }
      });
      window.addEventListener('orientationchange', () => {
        setTimeout(() => {
          adjustClockSize();
          if (document.getElementById('timerScreen').classList.contains('show')) {
            adjustTimerSize();
          }
        }, 100);
      });

      // ÌéòÏù¥ÏßÄÍ∞Ä Îã§Ïãú Î≥¥Ïùº Îïå Wake Lock Ïû¨ÌôúÏÑ±Ìôî
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden && runningTimer && !runningTimer.isPaused) {
          console.log('ÌéòÏù¥ÏßÄÍ∞Ä Îã§Ïãú Î≥¥ÏûÑ - Wake Lock Ïû¨ÌôúÏÑ±Ìôî');
          enableWakeLock();
        }
      });

      // Service Worker Îì±Î°ù (PWA)
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./service-worker.js')
          .then((registration) => {
            console.log('Service Worker Îì±Î°ù ÏÑ±Í≥µ:', registration);
          })
          .catch((error) => {
            console.log('Service Worker Îì±Î°ù Ïã§Ìå®:', error);
          });
      }
    });

    function setupEventListeners() {
      document.getElementById('mainScreen').addEventListener('click', handleMainScreenClick);
      document.getElementById('timerCardsOverlay').addEventListener('click', function(e) {
        if (e.target === this) hideTimerCards();
      });
      document.getElementById('timerScreen').addEventListener('click', handleTimerScreenClick);
      document.getElementById('pauseOverlay').addEventListener('click', handlePauseOverlayClick);
      document.getElementById('settingsBtn').addEventListener('click', function(e) {
        e.stopPropagation();
        showGlobalSettings();
      });

      // ÏãúÍ≥Ñ ÏòÅÏó≠ ÌÅ¥Î¶≠ Ïãú ÌÉÄÏù¥Î®∏ Ïπ¥Îìú Ïó¥Í∏∞
      document.querySelector('.clock-container').addEventListener('click', function(e) {
        e.stopPropagation();
        toggleTimerCards();
      });

      // ÎÇ†Ïßú ÏòÅÏó≠ ÌÅ¥Î¶≠ Ïãú ÌÉÄÏù¥Î®∏ Ïπ¥Îìú Ïó¥Í∏∞
      document.getElementById('dateDisplay').addEventListener('click', function(e) {
        e.stopPropagation();
        toggleTimerCards();
      });
      document.getElementById('pauseOverlay').addEventListener('touchstart', handleLongPressStart);
      document.getElementById('pauseOverlay').addEventListener('touchend', handleLongPressEnd);
      document.getElementById('pauseOverlay').addEventListener('mousedown', handleLongPressStart);
      document.getElementById('pauseOverlay').addEventListener('mouseup', handleLongPressEnd);
      document.getElementById('customSoundFile').addEventListener('change', handleCustomSoundUpload);

      // Î≤®ÏÜåÎ¶¨ ÏÑ†ÌÉù Ïãú ÎØ∏Î¶¨Îì£Í∏∞
      const soundSelects = [
        'prepareStartSound', 'prepareEndSound',
        'workStartSound', 'workEndSound',
        'restStartSound', 'restEndSound'
      ];
      soundSelects.forEach(selectId => {
        document.getElementById(selectId).addEventListener('change', function(e) {
          const soundType = e.target.value;
          if (soundType !== 'none') {
            playSound(soundType);
          }
        });
      });
    }


    function updateClock() {
      const now = new Date();
      const days = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const date = String(now.getDate()).padStart(2, '0');
      const day = days[now.getDay()];
      const dateText = month + '.' + date + ' ' + day;
      document.getElementById('dateDisplay').textContent = dateText;
      let hours = now.getHours();
      const ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12 || 12;
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      document.getElementById('ampm').textContent = ampm + ' ';
      document.getElementById('hours').textContent = String(hours).padStart(2, '0');
      document.getElementById('minutes').textContent = minutes;
      document.getElementById('seconds').textContent = ' ' + seconds;
      if (document.getElementById('timerScreen').classList.contains('show')) {
        document.getElementById('currentTimeSmall').textContent = String(hours).padStart(2, '0') + ':' + minutes;
      }
    }

    function adjustClockSize() {
      const clockContainer = document.querySelector('.clock-container');
      const timeDisplay = document.getElementById('timeDisplay');

      if (!clockContainer || !timeDisplay) return;

      // ÏãúÍ≥Ñ ÎÇ¥Ïö©Ïùò Ï†ÑÏ≤¥ ÌÖçÏä§Ìä∏ Í∏∏Ïù¥ Í≥ÑÏÇ∞ (AM/PM HH:MM SS ÌòïÏãù)
      const timeText = timeDisplay.textContent || 'AM 12:00 00';

      // Ïª®ÌÖåÏù¥ÎÑàÏùò Í∞ÄÏö© ÎÑàÎπÑ (90vw, Ìå®Îî© Í≥†Î†§)
      const containerWidth = window.innerWidth * 0.9 - 40; // padding 20px * 2
      const containerHeight = window.innerHeight * 0.6; // ÌôîÎ©¥ ÎÜíÏù¥Ïùò 60% ÏÇ¨Ïö©

      // Ïù¥ÏßÑ ÌÉêÏÉâÏúºÎ°ú ÏµúÏ†Å Ìè∞Ìä∏ ÌÅ¨Í∏∞ Ï∞æÍ∏∞
      let minSize = 10;
      let maxSize = 500;
      let optimalSize = minSize;

      // ÏûÑÏãú Ï∏°Ï†ïÏö© ÏöîÏÜå ÏÉùÏÑ±
      const tempTime = document.createElement('div');
      tempTime.style.position = 'absolute';
      tempTime.style.visibility = 'hidden';
      tempTime.style.whiteSpace = 'nowrap';
      tempTime.style.fontWeight = '700';
      tempTime.style.letterSpacing = '-0.02em';
      tempTime.style.display = 'flex';
      tempTime.style.gap = '0.15em';
      tempTime.innerHTML = timeDisplay.innerHTML;
      document.body.appendChild(tempTime);

      while (minSize <= maxSize) {
        const midSize = Math.floor((minSize + maxSize) / 2);
        tempTime.style.fontSize = midSize + 'px';

        const timeWidth = tempTime.offsetWidth;
        const timeHeight = tempTime.offsetHeight;

        if (timeWidth <= containerWidth && timeHeight <= containerHeight) {
          optimalSize = midSize;
          minSize = midSize + 1;
        } else {
          maxSize = midSize - 1;
        }
      }

      document.body.removeChild(tempTime);

      // ÏµúÏ¢Ö ÌÅ¨Í∏∞ Ï†ÅÏö© (ÏãúÍ∞Ñ ÌëúÏãúÎßå)
      timeDisplay.style.fontSize = optimalSize + 'px';
      // ÎÇ†Ïßú ÌëúÏãúÎäî CSSÎ°úÎßå Ï†úÏñ¥ (ÎèÖÎ¶ΩÏ†ÅÏúºÎ°ú ÏúÑÏπòÌïòÎØÄÎ°ú)
    }

    function applyGlobalSettings() {
      // Î∞∞Í≤Ω Í∑∏ÎùºÎç∞Ïù¥ÏÖò Î∞è Í∏ÄÏûêÏÉâ Ï†ÅÏö©
      const gradient = 'linear-gradient(135deg, ' + globalSettings.bgGradientStart + ' 0%, ' + globalSettings.bgGradientEnd + ' 100%)';
      document.getElementById('mainScreen').style.background = gradient;
      document.getElementById('mainScreen').style.color = globalSettings.fontColor;
      // body Î∞∞Í≤ΩÎèÑ ÎèôÏùºÌïòÍ≤å Ï†ÅÏö©
      document.body.style.background = gradient;
    }

    function showGlobalSettings() {
      document.getElementById('bgGradientStart').value = globalSettings.bgGradientStart;
      document.getElementById('bgGradientEnd').value = globalSettings.bgGradientEnd;
      document.getElementById('fontColor').value = globalSettings.fontColor;
      document.getElementById('keepScreenOn').checked = globalSettings.keepScreenOn;
      document.getElementById('soundEnabled').checked = globalSettings.soundEnabled;
      document.getElementById('vibrationEnabled').checked = globalSettings.vibrationEnabled;
      document.getElementById('globalSettingsModal').classList.add('show');

      // Í∑∏ÎùºÎç∞Ïù¥ÏÖò Ïã§ÏãúÍ∞Ñ ÎØ∏Î¶¨Î≥¥Í∏∞
      const updateGradient = function() {
        const startColor = document.getElementById('bgGradientStart').value;
        const endColor = document.getElementById('bgGradientEnd').value;
        const gradient = 'linear-gradient(135deg, ' + startColor + ' 0%, ' + endColor + ' 100%)';
        document.getElementById('mainScreen').style.background = gradient;
        document.body.style.background = gradient;
      };

      document.getElementById('bgGradientStart').oninput = updateGradient;
      document.getElementById('bgGradientEnd').oninput = updateGradient;

      document.getElementById('fontColor').oninput = function() {
        document.getElementById('mainScreen').style.color = this.value;
      };
    }

    function closeGlobalSettings() {
      document.getElementById('globalSettingsModal').classList.remove('show');
    }

    function saveGlobalSettings() {
      globalSettings.bgGradientStart = document.getElementById('bgGradientStart').value;
      globalSettings.bgGradientEnd = document.getElementById('bgGradientEnd').value;
      globalSettings.fontColor = document.getElementById('fontColor').value;
      globalSettings.keepScreenOn = document.getElementById('keepScreenOn').checked;
      globalSettings.soundEnabled = document.getElementById('soundEnabled').checked;
      globalSettings.vibrationEnabled = document.getElementById('vibrationEnabled').checked;
      localStorage.setItem('globalSettings', JSON.stringify(globalSettings));
      applyGlobalSettings();
      adjustClockSize();
      closeGlobalSettings();
      showToast('ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§');
    }

    function handleMainScreenClick(e) {
      // ÏÑ§Ï†ï Î≤ÑÌäº ÌÅ¥Î¶≠Ïù¥ ÏïÑÎãå Í≤ΩÏö∞ ÌÉÄÏù¥Î®∏ Ïπ¥Îìú Ïó¥Í∏∞
      if (!e.target.closest('#settingsBtn')) {
        toggleTimerCards();
      }
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement &&
          !document.webkitFullscreenElement &&
          !document.mozFullScreenElement &&
          !document.msFullscreenElement) {
        // Ï†ÑÏ≤¥ÌôîÎ©¥ ÏßÑÏûÖ
        requestFullscreen();
      } else {
        // Ï†ÑÏ≤¥ÌôîÎ©¥ Ï¢ÖÎ£å
        exitFullscreen();
      }
    }

    function toggleTimerCards() {
      const overlay = document.getElementById('timerCardsOverlay');
      if (overlay.classList.contains('show')) {
        hideTimerCards();
      } else {
        showTimerCards();
      }
    }

    function showTimerCards() {
      document.getElementById('timerCardsOverlay').classList.add('show');
    }

    function hideTimerCards() {
      document.getElementById('timerCardsOverlay').classList.remove('show');
    }

    function renderCards() {
      const grid = document.getElementById('cardsGrid');
      grid.innerHTML = '';
      timers.forEach(timer => {
        const card = createTimerCard(timer);
        grid.appendChild(card);
      });
      const addCard = document.createElement('div');
      addCard.className = 'timer-card add-card';
      addCard.innerHTML = '+';
      addCard.onclick = () => addNewTimer();
      grid.appendChild(addCard);
    }

    function createTimerCard(timer) {
      const card = document.createElement('div');
      card.className = 'timer-card';
      card.onclick = (e) => {
        if (!e.target.classList.contains('card-menu-btn')) {
          startTimer(timer.id);
        }
      };
      card.innerHTML = '<div class="card-header"><div class="card-name">' + timer.name + '</div><button class="card-menu-btn" onclick="event.stopPropagation(); editTimer(\'' + timer.id + '\')">‚ãÆ</button></div><div class="card-info">Ï§ÄÎπÑ: ' + timer.prepare.min + 'Î∂Ñ ' + timer.prepare.sec + 'Ï¥à<br>Ïö¥Îèô: ' + timer.work.min + 'Î∂Ñ ' + timer.work.sec + 'Ï¥à<br>Ìú¥Ïãù: ' + timer.rest.min + 'Î∂Ñ ' + timer.rest.sec + 'Ï¥à<br>ÎùºÏö¥Îìú: ' + timer.rounds + '</div>';
      return card;
    }

    function addNewTimer() {
      currentTimerId = 'timer_' + Date.now();
      const newTimer = {
        id: currentTimerId,
        name: 'ÌÉÄÏù¥Î®∏ ' + (timers.length + 1),
        prepare: { min: 0, sec: 10, bg: '#FFA500', color: '#FFFFFF', startSound: 'none', endSound: 'default' },
        work: { min: 0, sec: 30, bg: '#2196F3', color: '#FFFFFF', startSound: 'none', endSound: 'default' },
        rest: { min: 0, sec: 10, bg: '#FF0000', color: '#FFFFFF', startSound: 'none', endSound: 'default' },
        rounds: 3
      };
      timers.push(newTimer);
      editTimer(currentTimerId);
    }

    function editTimer(id) {
      currentTimerId = id;
      const timer = timers.find(t => t.id === id);
      if (!timer) return;
      document.getElementById('timerNameInput').value = timer.name;

      // Ï§ÄÎπÑ ÏãúÍ∞Ñ
      const prepareMin = String(timer.prepare.min).padStart(2, '0');
      const prepareSec = String(timer.prepare.sec).padStart(2, '0');
      document.getElementById('prepareMin1').value = prepareMin[0];
      document.getElementById('prepareMin2').value = prepareMin[1];
      document.getElementById('prepareSec1').value = prepareSec[0];
      document.getElementById('prepareSec2').value = prepareSec[1];
      document.getElementById('prepareBg').value = timer.prepare.bg;
      document.getElementById('prepareColor').value = timer.prepare.color;
      document.getElementById('prepareStartSound').value = timer.prepare.startSound || 'default';
      document.getElementById('prepareEndSound').value = timer.prepare.endSound || 'beep';

      // Ïö¥Îèô ÏãúÍ∞Ñ
      const workMin = String(timer.work.min).padStart(2, '0');
      const workSec = String(timer.work.sec).padStart(2, '0');
      document.getElementById('workMin1').value = workMin[0];
      document.getElementById('workMin2').value = workMin[1];
      document.getElementById('workSec1').value = workSec[0];
      document.getElementById('workSec2').value = workSec[1];
      document.getElementById('workBg').value = timer.work.bg;
      document.getElementById('workColor').value = timer.work.color;
      document.getElementById('workStartSound').value = timer.work.startSound || 'default';
      document.getElementById('workEndSound').value = timer.work.endSound || 'beep';

      // Ìú¥Ïãù ÏãúÍ∞Ñ
      const restMin = String(timer.rest.min).padStart(2, '0');
      const restSec = String(timer.rest.sec).padStart(2, '0');
      document.getElementById('restMin1').value = restMin[0];
      document.getElementById('restMin2').value = restMin[1];
      document.getElementById('restSec1').value = restSec[0];
      document.getElementById('restSec2').value = restSec[1];
      document.getElementById('restBg').value = timer.rest.bg;
      document.getElementById('restColor').value = timer.rest.color;
      document.getElementById('restStartSound').value = timer.rest.startSound || 'default';
      document.getElementById('restEndSound').value = timer.rest.endSound || 'beep';

      document.getElementById('rounds').value = timer.rounds;
      document.getElementById('timerSettingsModal').classList.add('show');
    }

    function closeTimerSettings() {
      document.getElementById('timerSettingsModal').classList.remove('show');
    }

    function saveTimer() {
      const timer = timers.find(t => t.id === currentTimerId);
      if (!timer) return;
      timer.name = document.getElementById('timerNameInput').value;

      // Ï§ÄÎπÑ ÏãúÍ∞Ñ
      timer.prepare.min = parseInt(document.getElementById('prepareMin1').value) * 10 + parseInt(document.getElementById('prepareMin2').value);
      timer.prepare.sec = parseInt(document.getElementById('prepareSec1').value) * 10 + parseInt(document.getElementById('prepareSec2').value);
      timer.prepare.bg = document.getElementById('prepareBg').value;
      timer.prepare.color = document.getElementById('prepareColor').value;
      timer.prepare.startSound = document.getElementById('prepareStartSound').value;
      timer.prepare.endSound = document.getElementById('prepareEndSound').value;

      // Ïö¥Îèô ÏãúÍ∞Ñ
      timer.work.min = parseInt(document.getElementById('workMin1').value) * 10 + parseInt(document.getElementById('workMin2').value);
      timer.work.sec = parseInt(document.getElementById('workSec1').value) * 10 + parseInt(document.getElementById('workSec2').value);
      timer.work.bg = document.getElementById('workBg').value;
      timer.work.color = document.getElementById('workColor').value;
      timer.work.startSound = document.getElementById('workStartSound').value;
      timer.work.endSound = document.getElementById('workEndSound').value;

      // Ìú¥Ïãù ÏãúÍ∞Ñ
      timer.rest.min = parseInt(document.getElementById('restMin1').value) * 10 + parseInt(document.getElementById('restMin2').value);
      timer.rest.sec = parseInt(document.getElementById('restSec1').value) * 10 + parseInt(document.getElementById('restSec2').value);
      timer.rest.bg = document.getElementById('restBg').value;
      timer.rest.color = document.getElementById('restColor').value;
      timer.rest.startSound = document.getElementById('restStartSound').value;
      timer.rest.endSound = document.getElementById('restEndSound').value;
      timer.rounds = parseInt(document.getElementById('rounds').value);
      saveTimers();
      renderCards();
      closeTimerSettings();
      showToast('ÌÉÄÏù¥Î®∏Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§');
    }

    function deleteTimer() {
      if (confirm('Ïù¥ ÌÉÄÏù¥Î®∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        timers = timers.filter(t => t.id !== currentTimerId);
        saveTimers();
        renderCards();
        closeTimerSettings();
        showToast('ÌÉÄÏù¥Î®∏Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');
      }
    }

    function copyTimer() {
      const timer = timers.find(t => t.id === currentTimerId);
      if (!timer) return;
      const newTimer = JSON.parse(JSON.stringify(timer));
      newTimer.id = 'timer_' + Date.now();
      newTimer.name = timer.name + ' Î≥µÏÇ¨';
      timers.push(newTimer);
      saveTimers();
      renderCards();
      closeTimerSettings();
      showToast('ÌÉÄÏù¥Î®∏Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§');
    }

    function startTimer(id) {
      const timer = timers.find(t => t.id === id);
      if (!timer) return;
      hideTimerCards();
      runningTimer = {
        config: timer,
        phase: 'prepare',
        currentRound: 1,
        remainingTime: timer.prepare.min * 60 + timer.prepare.sec,
        isPaused: false
      };
      showTimerScreen();
      updateTimerDisplay();
      playSound(timer.prepare.startSound);
      vibrate([200, 100, 200]);
      enableWakeLock();
      timerInterval = setInterval(() => {
        if (!runningTimer.isPaused) {
          runningTimer.remainingTime--;
          if (runningTimer.remainingTime === 3) {
            const phase = runningTimer.config[runningTimer.phase];
            playSound(phase.endSound);
            vibrate(100);
          }
          if (runningTimer.remainingTime <= 0) {
            vibrate([200, 100, 200, 100, 200]);
            nextPhase();
          }
          updateTimerDisplay();
        }
      }, 1000);
    }

    function nextPhase() {
      const timer = runningTimer.config;
      if (runningTimer.phase === 'prepare') {
        runningTimer.phase = 'work';
        runningTimer.remainingTime = timer.work.min * 60 + timer.work.sec;
        playSound(timer.work.startSound);
        vibrate([200, 100, 200]);
      } else if (runningTimer.phase === 'work') {
        runningTimer.phase = 'rest';
        runningTimer.remainingTime = timer.rest.min * 60 + timer.rest.sec;
        playSound(timer.rest.startSound);
        vibrate([200, 100, 200]);
      } else if (runningTimer.phase === 'rest') {
        if (runningTimer.currentRound < timer.rounds) {
          runningTimer.currentRound++;
          runningTimer.phase = 'work';
          runningTimer.remainingTime = timer.work.min * 60 + timer.work.sec;
          playSound(timer.work.startSound);
          vibrate([200, 100, 200]);
        } else {
          vibrate([300, 100, 300, 100, 300]);
          stopTimer();
          return;
        }
      }
      updateTimerDisplay();
    }

    function showTimerScreen() {
      document.getElementById('mainScreen').style.display = 'none';
      document.getElementById('timerScreen').classList.add('show');
      // ÌÉÄÏù¥Î®∏ ÌôîÎ©¥ ÌëúÏãú Ïãú ÌÉÄÏù¥Î®∏ ÌÅ¨Í∏∞ ÏûêÎèô Ï°∞Ï†ï
      setTimeout(() => {
        applyTimerScreenSettings();
      }, 100);
      // Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®Îìú ÏöîÏ≤≠
      requestFullscreen();
    }

    async function requestFullscreen() {
      const elem = document.documentElement;
      try {
        if (elem.requestFullscreen) {
          await elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) {
          await elem.webkitRequestFullscreen();
        } else if (elem.mozRequestFullScreen) {
          await elem.mozRequestFullScreen();
        } else if (elem.msRequestFullscreen) {
          await elem.msRequestFullscreen();
        }
        console.log('Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®Îìú ÌôúÏÑ±Ìôî');
      } catch (err) {
        console.log('Ï†ÑÏ≤¥ÌôîÎ©¥ ÏöîÏ≤≠ Ïã§Ìå®:', err.message);
        // Ï†ÑÏ≤¥ÌôîÎ©¥ Ïã§Ìå®Ìï¥ÎèÑ ÌÉÄÏù¥Î®∏Îäî Ï†ïÏÉÅ ÏûëÎèô
      }
    }

    function exitFullscreen() {
      try {
        if (document.exitFullscreen) {
          document.exitFullscreen().catch(err => console.log('Ï†ÑÏ≤¥ÌôîÎ©¥ Ï¢ÖÎ£å Ïã§Ìå®:', err));
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      } catch (err) {
        console.log('Ï†ÑÏ≤¥ÌôîÎ©¥ Ï¢ÖÎ£å Ï§ë Ïò§Î•ò:', err);
      }
    }

    function applyTimerScreenSettings() {
      adjustTimerSize();
    }

    function adjustTimerSize() {
      const timerTime = document.getElementById('timerTime');
      const timerPhase = document.querySelector('.timer-phase');
      const timerRound = document.querySelector('.timer-round');
      const timerName = document.querySelector('.timer-name');

      if (!timerTime) return;

      const isPortrait = window.innerHeight > window.innerWidth;
      const timerText = '00:00';

      if (isPortrait) {
        // ÏÑ∏Î°ú Î™®Îìú: ÌÉÄÏù¥Î®∏ ÏãúÍ∞ÑÎßå Í∞ÄÎ°ú ÎÑàÎπÑÏóê ÎßûÏ∂§
        const availableWidth = window.innerWidth * 0.9;

        let minSize = 20;
        let maxSize = 600;
        let optimalTimerSize = minSize;

        const tempTime = document.createElement('span');
        tempTime.style.position = 'absolute';
        tempTime.style.visibility = 'hidden';
        tempTime.style.whiteSpace = 'nowrap';
        tempTime.style.fontWeight = '800';
        tempTime.style.letterSpacing = '-3px';
        tempTime.style.fontVariantNumeric = 'tabular-nums';
        document.body.appendChild(tempTime);

        while (minSize <= maxSize) {
          const midSize = Math.floor((minSize + maxSize) / 2);
          tempTime.style.fontSize = midSize + 'px';
          tempTime.textContent = timerText;

          const timeWidth = tempTime.offsetWidth;

          if (timeWidth <= availableWidth) {
            optimalTimerSize = midSize;
            minSize = midSize + 1;
          } else {
            maxSize = midSize - 1;
          }
        }

        document.body.removeChild(tempTime);

        // ÏÑ∏Î°ú Î™®Îìú ÌÅ¨Í∏∞ Ï†ÅÏö©
        timerTime.style.fontSize = optimalTimerSize + 'px';
        const sideTextSize = optimalTimerSize * 0.35;
        if (timerPhase) timerPhase.style.fontSize = sideTextSize + 'px';
        if (timerRound) timerRound.style.fontSize = sideTextSize + 'px';
        if (timerName) timerName.style.fontSize = (sideTextSize * 0.9) + 'px';

      } else {
        // Í∞ÄÎ°ú Î™®Îìú: Í∏∞Ï°¥ Î°úÏßÅ (Ï†ÑÏ≤¥ Í∞ÄÎ°ú Î∞∞Ïπò)
        const availableWidth = window.innerWidth * 0.9;
        const phaseText = timerPhase ? timerPhase.textContent : 'Ï§ÄÎπÑ';
        const roundText = timerRound ? timerRound.textContent : '1/3';

        let minSize = 20;
        let maxSize = 500;
        let optimalTimerSize = minSize;

        const tempTimer = document.createElement('div');
        tempTimer.style.position = 'absolute';
        tempTimer.style.visibility = 'hidden';
        tempTimer.style.whiteSpace = 'nowrap';
        tempTimer.style.fontWeight = '800';
        tempTimer.style.letterSpacing = '-3px';
        tempTimer.style.display = 'flex';
        tempTimer.style.gap = 'clamp(15px, 4vw, 35px)';
        tempTimer.style.alignItems = 'center';
        document.body.appendChild(tempTimer);

        while (minSize <= maxSize) {
          const midSize = Math.floor((minSize + maxSize) / 2);

          const tempTime = document.createElement('span');
          tempTime.style.fontSize = midSize + 'px';
          tempTime.style.fontVariantNumeric = 'tabular-nums';
          tempTime.textContent = timerText;

          const sideSize = midSize * 0.3;
          const tempPhase = document.createElement('span');
          tempPhase.style.fontSize = sideSize + 'px';
          tempPhase.textContent = phaseText;

          const tempRoundEl = document.createElement('span');
          tempRoundEl.style.fontSize = sideSize + 'px';
          tempRoundEl.textContent = roundText;

          tempTimer.innerHTML = '';
          tempTimer.appendChild(tempPhase);
          tempTimer.appendChild(tempTime);
          tempTimer.appendChild(tempRoundEl);

          const totalWidth = tempTimer.offsetWidth;

          if (totalWidth <= availableWidth) {
            optimalTimerSize = midSize;
            minSize = midSize + 1;
          } else {
            maxSize = midSize - 1;
          }
        }

        document.body.removeChild(tempTimer);

        // Í∞ÄÎ°ú Î™®Îìú ÌÅ¨Í∏∞ Ï†ÅÏö©
        timerTime.style.fontSize = optimalTimerSize + 'px';
        const sideTextSize = optimalTimerSize * 0.3;
        if (timerPhase) timerPhase.style.fontSize = sideTextSize + 'px';
        if (timerRound) timerRound.style.fontSize = sideTextSize + 'px';
        if (timerName) timerName.style.fontSize = (sideTextSize * 0.9) + 'px';
      }
    }

    function updateTimerDisplay() {
      if (!runningTimer) return;
      const minutes = Math.floor(runningTimer.remainingTime / 60);
      const seconds = runningTimer.remainingTime % 60;
      document.getElementById('timerMinutes').textContent = String(minutes).padStart(2, '0');
      document.getElementById('timerSeconds').textContent = String(seconds).padStart(2, '0');
      let phaseText = '';
      if (runningTimer.phase === 'prepare') phaseText = 'Ï§ÄÎπÑ';
      else if (runningTimer.phase === 'work') phaseText = 'Ïö¥Îèô';
      else if (runningTimer.phase === 'rest') phaseText = 'Ìú¥Ïãù';
      document.getElementById('timerPhase').textContent = phaseText;
      document.getElementById('timerRound').textContent = runningTimer.currentRound + '/' + runningTimer.config.rounds;
      document.getElementById('timerName').textContent = runningTimer.config.name;
      const phase = runningTimer.config[runningTimer.phase];
      document.getElementById('timerScreen').style.backgroundColor = phase.bg;
      document.getElementById('timerScreen').style.color = phase.color;

      // currentTimeSmallÏùÄ Î∏îÎûô Í∏ÄÎùºÏä§ Ïä§ÌÉÄÏùº Ïú†ÏßÄ (CSSÏóêÏÑú Ï†ïÏùòÎê®)
    }

    function handleTimerScreenClick(e) {
      if (e.target.id === 'stopGuide' || longPressTimer) return;
      if (!runningTimer.isPaused) {
        runningTimer.isPaused = true;
        document.getElementById('stopGuide').classList.add('show');
        document.getElementById('timerScreen').classList.add('paused');
        document.getElementById('pauseOverlay').classList.add('show');
        vibrate(50);
      }
    }

    function handlePauseOverlayClick(e) {
      if (longPressTimer) return;
      if (runningTimer && runningTimer.isPaused) {
        runningTimer.isPaused = false;
        document.getElementById('stopGuide').classList.remove('show');
        document.getElementById('timerScreen').classList.remove('paused');
        document.getElementById('pauseOverlay').classList.remove('show');
        vibrate(50);
        showToast('ÌÉÄÏù¥Î®∏ Ïû¨Í∞ú');
        // Ï†ÑÏ≤¥ÌôîÎ©¥ Ïû¨ÏßÑÏûÖ
        requestFullscreen();
      }
    }

    function handleLongPressStart(e) {
      if (!runningTimer.isPaused) return;
      e.preventDefault();
      document.getElementById('progressCircle').classList.add('show', 'filling');
      longPressTimer = setTimeout(() => {
        vibrate(200);
        stopTimer();
      }, 1000);
    }

    function handleLongPressEnd(e) {
      if (longPressTimer) {
        clearTimeout(longPressTimer);
        longPressTimer = null;
        document.getElementById('progressCircle').classList.remove('show', 'filling');
        // ÏßßÍ≤å ÌÑ∞ÏπòÌñàÏùÑ Îïå ÌÉÄÏù¥Î®∏ Ïû¨Í∞ú
        if (runningTimer && runningTimer.isPaused) {
          runningTimer.isPaused = false;
          document.getElementById('stopGuide').classList.remove('show');
          document.getElementById('timerScreen').classList.remove('paused');
          document.getElementById('pauseOverlay').classList.remove('show');
          vibrate(50);
          showToast('ÌÉÄÏù¥Î®∏ Ïû¨Í∞ú');
          // Ï†ÑÏ≤¥ÌôîÎ©¥ Ïû¨ÏßÑÏûÖ
          requestFullscreen();
        }
      }
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      disableWakeLock();
      // Ï†ÑÏ≤¥ÌôîÎ©¥ Ïú†ÏßÄ (exitFullscreen Ï†úÍ±∞)
      runningTimer = null;
      document.getElementById('timerScreen').classList.remove('show', 'paused');
      document.getElementById('mainScreen').style.display = 'flex';
      document.getElementById('stopGuide').classList.remove('show');
      document.getElementById('pauseOverlay').classList.remove('show');
      document.getElementById('progressCircle').classList.remove('show', 'filling');
    }

    function handleCustomSoundUpload(event) {
      const files = event.target.files;
      if (!files || files.length === 0) return;
      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const soundName = file.name.split('.')[0];
          customSounds[soundName] = e.target.result;
          localStorage.setItem('customSounds', JSON.stringify(customSounds));
          addCustomSoundOption(soundName);
        };
        reader.readAsDataURL(file);
      });
      showToast('ÏùåÏõêÏù¥ ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§');
    }

    function addCustomSoundOption(soundName) {
      const selects = document.querySelectorAll('select[id$="Sound"]');
      selects.forEach(select => {
        const exists = Array.from(select.options).some(opt => opt.value === soundName);
        if (!exists) {
          const option = document.createElement('option');
          option.value = soundName;
          option.textContent = soundName;
          select.appendChild(option);
        }
      });
    }

    function playSound(soundType) {
      if (soundType === 'none') return;
      const vol = 1.0; // Í≥†Ï†ï Î≥ºÎ•® 100%

      // AudioContext Ï¥àÍ∏∞Ìôî (ÏÇ¨Ïö©Ïûê Ïù∏ÌÑ∞ÎûôÏÖòÏúºÎ°ú ÌôúÏÑ±Ìôî)
      if (!audioContext) {
        try {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
        } catch (err) {
          console.log('AudioContext Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', err);
        }
      }

      // ÏÇ¨Ïö©Ïûê ÏóÖÎ°úÎìú ÏÇ¨Ïö¥Îìú ÌôïÏù∏
      if (customSounds[soundType]) {
        playCustomSound(customSounds[soundType]);
        return;
      }

      // sounds Ìè¥ÎçîÏùò ÌååÏùº ÌôïÏù∏
      const soundFiles = {
        'bell': './sounds/bell.mp3',
        'alarm': './sounds/alarm.mp3',
        'boxing': './sounds/boxing.mp3',
        'start': './sounds/start.mp3',
        'wow': './sounds/wow.mp3',
        'ac': './sounds/ac.mp3'
      };

      if (soundFiles[soundType]) {
        playAudioFile(soundFiles[soundType]);
        return;
      }

      // Í∏∞Î≥∏ ÌÜ§ ÏÇ¨Ïö¥Îìú (Ìè¥Î∞±)
      switch(soundType) {
        case 'beep':
          playTone(1000, 0.3, vol);
          break;
        case 'default':
          playTone(800, 0.2, vol);
          setTimeout(() => playTone(600, 0.3, vol), 200);
          break;
      }
    }

    function playAudioFile(filePath) {
      // Ïù¥Ï†Ñ Ïò§ÎîîÏò§ Ï†ïÏßÄ
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
      }
      currentAudio = new Audio(filePath);
      currentAudio.volume = 1.0; // Í≥†Ï†ï Î≥ºÎ•® 100%
      currentAudio.play().catch(err => console.log('ÏÜåÎ¶¨ Ïû¨ÏÉù Ïã§Ìå®:', err));
    }

    function playCustomSound(dataUrl) {
      // Ïù¥Ï†Ñ Ïò§ÎîîÏò§ Ï†ïÏßÄ
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
      }
      currentAudio = new Audio(dataUrl);
      currentAudio.volume = 1.0; // Í≥†Ï†ï Î≥ºÎ•® 100%
      currentAudio.play().catch(err => console.log('ÏÜåÎ¶¨ Ïû¨ÏÉù Ïã§Ìå®:', err));
    }

    function playTone(frequency, duration, volume) {
      // ÌïÑÏöî Ïãú AudioContext Ï¥àÍ∏∞Ìôî (iOS Ìò∏Ìôò)
      if (!audioContext) {
        try {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
        } catch (err) {
          console.log('AudioContext Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', err);
          return;
        }
      }

      try {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        oscillator.frequency.value = frequency;
        oscillator.type = 'sine';
        gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration);
      } catch (err) {
        console.log('ÏÜåÎ¶¨ Ïû¨ÏÉù Ïã§Ìå®:', err);
      }
    }

    function vibrate(pattern) {
      if (globalSettings.vibrationEnabled && 'vibrate' in navigator) {
        navigator.vibrate(pattern);
      }
    }

    async function enableWakeLock() {
      if (!globalSettings.keepScreenOn) return;
      try {
        if ('wakeLock' in navigator && navigator.wakeLock) {
          // Í∏∞Ï°¥ Wake LockÏù¥ ÏûàÏúºÎ©¥ Î®ºÏ†Ä Ìï¥Ï†ú
          if (wakeLock) {
            try {
              await wakeLock.release();
            } catch (e) {}
          }

          wakeLock = await navigator.wakeLock.request('screen');
          console.log('ÌôîÎ©¥ Í∫ºÏßê Î∞©ÏßÄ ÌôúÏÑ±Ìôî');

          // Wake LockÏù¥ Ìï¥Ï†úÎêòÏóàÏùÑ Îïå Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
          wakeLock.addEventListener('release', () => {
            console.log('Wake LockÏù¥ Ìï¥Ï†úÎê®');
            wakeLock = null;
            // ÌÉÄÏù¥Î®∏Í∞Ä Ïã§Ìñâ Ï§ëÏù¥Î©¥ ÏûêÎèôÏúºÎ°ú Îã§Ïãú ÌôúÏÑ±Ìôî
            if (runningTimer && !runningTimer.isPaused) {
              setTimeout(() => enableWakeLock(), 100);
            }
          });
        } else {
          console.log('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî WakeLockÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§');
        }
      } catch (err) {
        console.log('ÌôîÎ©¥ Í∫ºÏßê Î∞©ÏßÄ Ïã§Ìå®:', err);
      }
    }

    async function disableWakeLock() {
      if (wakeLock) {
        try {
          await wakeLock.release();
          wakeLock = null;
          console.log('ÌôîÎ©¥ Í∫ºÏßê Î∞©ÏßÄ Ìï¥Ï†ú');
        } catch (err) {
          console.log('WakeLock Ìï¥Ï†ú Ïã§Ìå®:', err);
        }
      }
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function showTimerScreenSettings() {
      document.getElementById('timerScreenSettingsModal').classList.add('show');
    }

    function closeTimerScreenSettings() {
      document.getElementById('timerScreenSettingsModal').classList.remove('show');
    }

    function saveTimerScreenSettings() {
      // ÌÅ¨Í∏∞ Ï°∞Ï†à Í∏∞Îä• Ï†úÍ±∞Îê® - ÏûêÎèô Ï°∞Ï†ïÏúºÎ°ú ÎåÄÏ≤¥
      closeTimerScreenSettings();
    }

    function loadTimerScreenSettings() {
      const saved = localStorage.getItem('timerScreenSettings');
      if (saved) {
        const parsed = JSON.parse(saved);
        timerScreenSettings = Object.assign(timerScreenSettings, parsed);
      }
    }

    function saveTimers() {
      localStorage.setItem('timers', JSON.stringify(timers));
    }

    function loadTimers() {
      const saved = localStorage.getItem('timers');
      if (saved) {
        timers = JSON.parse(saved);
        // Í∏∞Ï°¥ ÌÉÄÏù¥Î®∏ ÏÉâÏÉÅ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò (Ïù¥Ï†Ñ Îπ®Í∞ï->Î∏îÎ£®, Ï¥àÎ°ù->Î†àÎìú)
        timers.forEach(timer => {
          // Ïö¥ÎèôÏù¥ Îπ®Í∞ï(#FF0000)Ïù¥Î©¥ Î∏îÎ£®Î°ú Î≥ÄÍ≤Ω
          if (timer.work.bg === '#FF0000') {
            timer.work.bg = '#2196F3';
          }
          // Ìú¥ÏãùÏù¥ Ï¥àÎ°ù(#00FF00)Ïù¥Î©¥ Î†àÎìúÎ°ú Î≥ÄÍ≤Ω
          if (timer.rest.bg === '#00FF00') {
            timer.rest.bg = '#FF0000';
            timer.rest.color = '#FFFFFF';
          }
          // ÏÜåÎ¶¨ ÏÑ§Ï†ïÏù¥ ÏóÜÏúºÎ©¥ ÏÉàÎ°úÏö¥ Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÑ§Ï†ï
          if (!timer.prepare.startSound) timer.prepare.startSound = 'none';
          if (!timer.prepare.endSound) timer.prepare.endSound = 'default';
          if (!timer.work.startSound) timer.work.startSound = 'none';
          if (!timer.work.endSound) timer.work.endSound = 'default';
          if (!timer.rest.startSound) timer.rest.startSound = 'none';
          if (!timer.rest.endSound) timer.rest.endSound = 'default';
        });
        saveTimers(); // ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÎÇ¥Ïö© Ï†ÄÏû•
      } else {
        timers = [{
          id: 'timer_default',
          name: 'Í∏∞Î≥∏ ÌÉÄÏù¥Î®∏',
          prepare: { min: 0, sec: 10, bg: '#FFA500', color: '#FFFFFF', startSound: 'none', endSound: 'default' },
          work: { min: 0, sec: 30, bg: '#2196F3', color: '#FFFFFF', startSound: 'none', endSound: 'default' },
          rest: { min: 0, sec: 10, bg: '#FF0000', color: '#FFFFFF', startSound: 'none', endSound: 'default' },
          rounds: 3
        }];
      }
    }

    // ÏÉâÏÉÅ ÌîÑÎ¶¨ÏÖã Îπ†Î•∏ ÏÑ†ÌÉù Ìï®Ïàò
    function setPhaseColors(phase, bgColor, textColor) {
      const bgInput = document.getElementById(`${phase}Bg`);
      const colorInput = document.getElementById(`${phase}Color`);

      if (bgInput) bgInput.value = bgColor.toUpperCase();
      if (colorInput) colorInput.value = textColor.toUpperCase();
    }

    function loadSettings() {
      const saved = localStorage.getItem('globalSettings');
      if (saved) {
        const parsed = JSON.parse(saved);
        globalSettings = Object.assign(globalSettings, parsed);
      }
      const savedSounds = localStorage.getItem('customSounds');
      if (savedSounds) {
        customSounds = JSON.parse(savedSounds);
        Object.keys(customSounds).forEach(soundName => {
          addCustomSoundOption(soundName);
        });
      }
    }
  </script>
  
</body>
</html>